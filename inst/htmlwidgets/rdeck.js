!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.rdeck=t():e.rdeck=t()}(self,(function(){return(()=>{var e={3737:(e,t,n)=>{"use strict";n.r(t),n.d(t,{VERSION:()=>Le,binding:()=>we});var r={};n.r(r),n.d(r,{AGGREGATION_OPERATION:()=>s.KM,ArcLayer:()=>i.zv,BitmapLayer:()=>i.hz,CPUGridLayer:()=>s.ab,ColumnLayer:()=>i.eJ,ContourLayer:()=>s.YY,GPUGridLayer:()=>s.ML,GeoJsonLayer:()=>i.UW,GreatCircleLayer:()=>l.GJ,GridCellLayer:()=>i.cJ,GridLayer:()=>s.mU,H3ClusterLayer:()=>l.cH,H3HexagonLayer:()=>l.bW,HeatmapLayer:()=>s.zP,HexagonLayer:()=>s.dX,IconLayer:()=>i.eE,LineLayer:()=>i.Ie,MVTLayer:()=>l.i3,PathLayer:()=>i.nr,PointCloudLayer:()=>i.U5,PolygonLayer:()=>i.dW,S2Layer:()=>l.jJ,ScatterplotLayer:()=>i.pU,ScenegraphLayer:()=>u.S,ScreenGridLayer:()=>s.p3,SimpleMeshLayer:()=>u.L,SolidPolygonLayer:()=>i.PJ,TerrainLayer:()=>l.tr,TextLayer:()=>i.AB,Tile3DLayer:()=>l.cY,TileLayer:()=>l.Im,TripsLayer:()=>l.Fw,_AggregationLayer:()=>s.Di,_BinSorter:()=>s.l0,_CPUAggregator:()=>s.oA,_GPUGridAggregator:()=>s.Wc,_MultiIconLayer:()=>i.vb});n(3948);var a=n(7294),o=n(3935),c=n(6042),i=(n(8559),n(3810)),s=n(6681),l=n(8623),u=n(1864),p=n(5736);const d=[0,0,0,255];function m([e,t,n,r=255]){return"rgba(".concat(e,", ").concat(t,", ").concat(n,", ").concat(r/255,")")}function f(e,t){var n,r;return Array.isArray(e)?t||4!==e.length?((t=null!=(n=t)?n:[])[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=3===e.length?e[3]:255,t):e:"string"==typeof e?(function(e,t){if(7===e.length){const n=parseInt(e.substring(1),16);t[0]=Math.floor(n/65536),t[1]=Math.floor(n/256%256),t[2]=n%256,t[3]=255}else if(9===e.length){const n=parseInt(e.substring(1),16);t[0]=Math.floor(n/16777216),t[1]=Math.floor(n/65536%256),t[2]=Math.floor(n/256%256),t[3]=n%256}}(e,t=null!=(r=t)?r:[]),t):d}var y=n(1960),h=n(5128),g=n(3446),b=n(6297),v=n(7603),E=n(6602);function w(e){return null!==e&&"object"==typeof e&&"accessor"===e.type}function L(e,t){const n=function({col:e,dataType:t},n){if("highlightColor"===n)switch(t){case"table":return function(e){return({index:t,layer:n})=>f(n.props.data.frame[e][t])}(e);case"object":return function(e){return({object:t})=>f(t[e])}(e);case"geojson":return function(e){return({object:t})=>f(t.properties[e])}(e);default:throw TypeError("".concat(t," not supported"))}if(n.endsWith("Color"))switch(t){case"table":return function(e){return(t,{index:n,data:r,target:a})=>f(r.frame[e][n],a)}(e);case"object":return function(e){return(t,{target:n})=>f(t[e],n)}(e);case"geojson":return function(e){return(t,{target:n})=>f(t.properties[e],n)}(e);default:throw TypeError("".concat(t," not supported"))}switch(t){case"table":return function(e){return(t,{index:n,data:r})=>r.frame[e][n]}(e);case"object":return function(e){return t=>t[e]}(e);case"geojson":return function(e){return t=>t.properties[e]}(e);default:throw TypeError("".concat(t," not supported"))}}(e,t);return{...e,getData:n}}function k(e){return w(e)&&"scale"in e}function x(e,t){"palette"in e&&(e.range=e.palette.map((e=>f(e))),e.unknown=f(e.unknown));const n=function(e){switch(e.scale){case"linear":return(0,y.Z)().domain(e.domain).range(e.range).unknown(e.unknown).clamp(!0);case"power":return(0,h.ZP)().exponent(e.exponent).domain(e.domain).range(e.range).unknown(e.unknown).clamp(!0);case"log":return(0,g.Z)().base(e.base).domain(e.domain).range(e.range).unknown(e.unknown).clamp(!0);case"threshold":case"quantile":return(0,b.Z)().domain(e.domain).range(e.range).unknown(e.unknown);case"category":return(0,v.Z)().domain(e.domain).range(e.range).unknown(e.unknown);case"quantize":return(0,E.Z)().domain(e.domain).range(e.range).unknown(e.unknown);default:throw TypeError("scale ".concat(e.scale," not supported"))}}(e),r="highlightColor"===t?function({col:e,dataType:t},n){switch(t){case"table":return function(e,t){return({index:n,layer:r})=>{var a;return t(null!=(a=r.props.data.frame[e][n])?a:void 0)}}(e,n);case"object":return function(e,t){return({object:n})=>{var r;return t(null!=(r=n[e])?r:void 0)}}(e,n);case"geojson":return function(e,t){return({object:n})=>{var r;return t(null!=(r=n.properties[e])?r:void 0)}}(e,n);default:throw TypeError("".concat(t," not supported"))}}(e,n):function({col:e,dataType:t},n){switch(t){case"table":return function(e,t){return(n,{index:r,data:a})=>{var o;return t(null!=(o=a.frame[e][r])?o:void 0)}}(e,n);case"object":return function(e,t){return n=>{var r;return t(null!=(r=n[e])?r:void 0)}}(e,n);case"geojson":return function(e,t){return n=>{var r;return t(null!=(r=n.properties[e])?r:void 0)}}(e,n);default:throw TypeError("".concat(t," not supported"))}}(e,n);return{...e,name:t,getData:r,scaleData:n}}function T(e="normal"){switch(e){case"additive":return{3042:!0,blendFunc:[770,772],blendEquation:32774};case"subtractive":return{3042:!0,blendFunc:[1,775,770,772],blendEquation:[32778,32774]};case"normal":default:return{3042:!0,blendFunc:[770,771,1,771],blendEquation:[32774,32774]}}}n(5827),n(5306);function j(e){return null!==e&&"object"==typeof e&&"frame"in e}function M(e){const t=function(e){return Object.entries(e.geometry).filter((([,e])=>/MULTI/.test(e))).map((([e,t])=>({name:e,type:t})))}(e);return 0===t.length?e:t.reduce(O,e)}function O(e,{name:t,type:n}){const r=e.frame,a=Object.fromEntries(Object.entries(r).map((([e])=>[e,[]]))),o=Object.keys(e.frame).filter((e=>e!==t)),c=r[t],i=function(e){switch(e){case"MULTIPOINT":return A;case"MULTILINESTRING":return S;case"MULTIPOLYGON":return N;default:throw TypeError("".concat(e," not supported"))}}(n),s=e=>{for(const t of o)a[t].push(r[t][e])},l=[];for(let n=0;n<e.length;n++){const r=c[n];if(i(r)){a[t].push(...r);for(let t=0;t<r.length;t++){var u,p;s(n),l.push(null!=(u=null===(p=e.indices)||void 0===p?void 0:p[n])?u:n)}}else{var d,m;a[t].push(r),s(n),l.push(null!=(d=null===(m=e.indices)||void 0===m?void 0:m[n])?d:n)}}return{length:a[t].length,geometry:{...e.geometry,[t]:n.replace("MULTI","")},indices:l,frame:a}}function A(e){return Array.isArray(e[0])}function S(e){return Array.isArray(e[0][0])}function N(e){return Array.isArray(e[0][0][0])}var C=n(1118),P=n(1614),Z=n(8988),_=n(2734),z=n(8261),I=n(3767),D=n(6305),G=n(7180);class U extends C.Z{initializeState(){if(!function(e){return H.some((t=>e instanceof t))}(this))return;const e=this,t=e.getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:5121,size:3,accessor:(t,{index:n,data:r,target:a})=>e.encodePickingColor(j(r)&&Array.isArray(r.indices)?r.indices.indexOf(r.indices[n]):n,a)}})}}const H=[P.Z,Z.Z,_.Z,z.Z,I.Z,D.Z,G.Z];class R{constructor({type:e,...t}){this.type=void 0,this.props=void 0,this.scales=void 0;const n=Object.entries(t),r=function(e){const t=e.filter(W).map((([e,t])=>[e,f(t)])),n=e.find((([e])=>"colorRange"===e));n&&t.push([n[0],n[1].map((e=>f(e)))]);return t}(n),a=function(e){return e.filter((([,e])=>w(e))).map((([e,t])=>[e,k(t)?x(t,e):L(t,e)]))}(n);this.type=e;const o=Object.fromEntries([...n,...r,...a.map((([e,t])=>[e,t.getData])),...Y(n),["updateTriggers",q(a)],["parameters",(c=t.parameters,i=t.blendingMode,{...c,...T(i)})]]);var c,i,s;j(o.data)&&(o.data=M(o.data),o.extensions=[new U,...null!=(s=o.extensions)?s:[]]);"TileLayer"===e&&(o.renderSubLayers=e=>{const{bbox:{west:t,south:n,east:r,north:a},x:o,y:c,z:i}=e.tile;return new p.Z({...e,data:[{z:i,x:o,y:c}],image:e.data,bounds:[t,n,r,a]})}),this.props=o,this.scales=a.filter((([,e])=>k(e))).map((([,e])=>e)),"TextLayer"===e&&"fonts"in document&&document.fonts.load("16px ".concat(t.fontFamily))}static create(e){return new R(e)}renderLayer(e){if("TripsLayer"===this.type&&void 0!==e){const t=this.props,{loopLength:n,animationSpeed:r}=t,a=n/r,o=e/1e3%a/a;t.currentTime=o*n}return new r[this.type]({...this.props})}renderLegend(){const e=this.scales.filter((e=>e.legend));return{id:this.props.id,name:this.props.name,scales:e}}}function W([e,t]){return e.endsWith("Color")&&(Array.isArray(t)||"string"==typeof t)}function q(e){const t=e=>{const{getData:t,scaleData:n,palette:r,...a}=e;return a},n=e.map((([e,n])=>[e,t(n)]));return Object.fromEntries(n)}function Y(e){return e.filter((([e])=>"getColorWeight"===e||"getElevationWeight"===e)).filter((([,e])=>null!==e&&"function"!=typeof e&&!w(e))).map((([e,t])=>[e,()=>t]))}var B=n(7391),F=n(7590);const Q="_3rdxBLth1N2ey-DR8zZS3k",J="_3a-qtBZofjlel3EyiZrLe0",K="_3L9Gh0vaiKQ5lmrBXb1Ppa",V="_4LWuEkar5BaPjDJypGFMM",X="_1SNUXvO9jR7Km5I-4zWVkl",$=({info:e})=>{if(null==e)return null;const{index:t,layer:n,x:r,y:o}=e,{name:c,tooltip:i}=n.props,s=function(e){switch(e){case"table":return(e,{index:t,data:n})=>{const r=Object.entries(n.frame).map((([e,n])=>[e,n[t]]));return Object.fromEntries(r)};case"object":return e=>e;case"geojson":return e=>{var t;return null!=(t=e.properties)?t:{}};default:throw TypeError("".concat(e," not supported"))}}(i.dataType)(e.object,{index:t,data:n.props.data}),l=!0===i.cols?Object.keys(s):i.cols;return a.createElement("div",{className:Q,style:{transform:"translate(".concat(r,"px, ").concat(o,"px)")}},a.createElement("div",{className:J},c),a.createElement("table",{className:K},a.createElement("tbody",null,l.map((e=>{var t;return a.createElement("tr",{key:e},a.createElement("td",{className:V},e),a.createElement("td",{className:X},String(null!=(t=s[e])?t:null)))})))))},ee=(0,a.memo)($);function te(){return(te=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function ne({props:e,layers:t}){const n=(0,a.useRef)(null),[r,o]=re(),{mapboxApiAccessToken:i,mapStyle:s,mapOptions:l,controller:u,parameters:p,blendingMode:d,...m}=e,f={...p,...T(d)},[y,h]=(0,a.useState)((()=>t.map((e=>e.renderLayer())))),g=0!==t.filter((e=>"TripsLayer"===e.type)).length;return ae(g,(e=>h(t.map((t=>t.renderLayer(e)))))),a.createElement(a.Fragment,null,a.createElement(B.Z,te({ref:n},m,{parameters:f,layers:y,onHover:o}),a.createElement(F.Z,{id:"map",controller:u,repeat:!0},s&&a.createElement(c.Z3,te({reuseMaps:!0},{mapboxApiAccessToken:i,mapStyle:s,mapOptions:l})))),a.createElement(ee,{info:r}))}const re=()=>{const[e,t]=(0,a.useState)(null);return[e,(0,a.useCallback)((e=>{if(!e.picked||!e.layer.props.tooltip)return t(null);t(e)}),[])]},ae=(e,t)=>{const n=(0,a.useRef)(0),r=(0,a.useRef)(Date.now()),o=()=>{t(Date.now()-r.current),n.current=window.requestAnimationFrame(o)};(0,a.useEffect)((()=>{if(e)return n.current=window.requestAnimationFrame(o),()=>window.cancelAnimationFrame(n.current)}),[e])};function oe(e){return e.clientHeight>0&&e.clientHeight>0?e:e.parentElement?oe(e.parentElement):null}function ce(e){const t=oe(e);if(e===t||null==t)return[e.clientWidth,e.clientHeight];const{width:n,height:r}=getComputedStyle(e),a=document.createElement("div");Object.assign(a.style,{width:n,height:r,display:"hidden"}),t.appendChild(a);const o=[a.clientWidth,a.clientHeight];return t.removeChild(a),o}const ie={legend:"_19x6CEViDqIUJgmzMHUO_L",kepler:"kepler",light:"light",layer:"_1O5QPr7CiTBczYArgl3S--","layer-name":"_1_q1TQIZ88zoNRCuCezvNi",layerName:"_1_q1TQIZ88zoNRCuCezvNi",scale:"ePCUM6mslf2Y-i0jhVFMh","scale-name":"_3YhhTqYy3O5ALWcQDpz_EK",scaleName:"_3YhhTqYy3O5ALWcQDpz_EK","scale-by":"lMTfZcYbDODR5PTtyG7HK",scaleBy:"lMTfZcYbDODR5PTtyG7HK","color-scale":"_1mPi0Qw9KZYGIt5csk3PZh",colorScale:"_1mPi0Qw9KZYGIt5csk3PZh",tick:"UU3enfH0Fz4EvQztbQYag",line:"_8tiBQbbvJsBZ-JMiVr_n9"};function se(){return(se=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const le=16;function ue({layers:e}){return 0===e.length?null:a.createElement("div",{className:ie.legend},e.map((e=>a.createElement(pe,se({key:e.id},e)))))}function pe({name:e,scales:t}){return 0===t.length?null:a.createElement("div",{className:ie.layer},a.createElement("div",{className:ie.layerName},e),t.map((e=>a.createElement(de,se({key:e.name},e)))))}function de(e){const t=e.name.replace(/^get/,"").replace(/([A-Z])/g," $1").toLowerCase();const n="palette"in e;const r=function(e){return"linear"===e.scale||"power"===e.scale||"log"===e.scale}(e),o=function(e){return"threshold"===e.scale||"quantile"===e.scale||"quantize"===e.scale}(e);return a.createElement("div",{className:ie.scale},a.createElement("div",{className:ie.scaleName},t),a.createElement("span",{className:ie.scaleBy},"by "),a.createElement("span",{className:ie.fieldName},e.col),n&&r&&a.createElement(me,e),n&&o&&a.createElement(fe,e),n&&"category"===e.scale&&a.createElement(ye,e))}const me=({ticks:e,scaleData:t})=>{const n=e.map(((e,t)=>t)).slice(1,-1),r=le*(e.length-1),o=r+10+1;return a.createElement("svg",{className:ie.colorScale,height:o,shapeRendering:"crispEdges"},a.createElement("svg",{y:5},a.createElement("image",{width:20,height:r,href:ge(t),preserveAspectRatio:"none"}),n.map((e=>a.createElement("line",{key:e,className:ie.line,x2:20,y1:le*e,y2:le*e})))),a.createElement(he,{ticks:e,y:-2}))},fe=({ticks:e,range:t})=>{const n=t.map(m),r=le*(e.length-1)+10+1;return a.createElement("svg",{className:ie.colorScale,height:r,shapeRendering:"crispEdges"},a.createElement("svg",{y:5},n.map(((e,t)=>a.createElement("rect",{key:t,width:20,height:le,y:t*le,fill:e})))),a.createElement(he,{ticks:e,y:-2}))};function ye({ticks:e,range:t,unknownTick:n,unknown:r}){const o=n?[...t,r]:t,c=n?[...e,n]:e,i=o.map(m),s=le*c.length;return a.createElement("svg",{className:ie.colorScale,height:s},a.createElement("svg",null,i.map(((e,t)=>a.createElement("rect",{key:t,width:20,height:14,y:1+t*le,fill:e})))),a.createElement(he,{ticks:c}))}function he({ticks:e,x:t=28,y:n=0}){return a.createElement("svg",{x:t,y:n},e.map(((e,t)=>a.createElement("text",{key:t,className:ie.tick,y:le*t,dy:10},String(e)))))}function ge(e,t=200){const n=e.range().length,r=[...Array(n).keys()].map((e=>e/(n-1))),a=e.copy().range(r).invert,o=document.createElement("canvas"),c=o.getContext("2d");o.width=1,o.height=t;for(let n=0;n<t;n++)c.fillStyle=m(e(a(n/t))),c.fillRect(0,n,1,1);return o.toDataURL()}const be="rdeck";function ve({props:e,layers:t,theme:n="kepler",width:r,height:o}){const{initialBounds:i,initialViewState:s,...l}=e,u=function(e,t,n,r){return(0,a.useMemo)((()=>{if(!Array.isArray(n))return r;const[a,o,i,s]=n,l=[[Math.max(-180,a),Math.max(o,-85.051129)],[Math.min(180,i),Math.min(s,85.051129)]],u=new c.DW({width:e,height:t}),{longitude:p,latitude:d,zoom:m}=u.fitBounds(l);return{...r,longitude:p,latitude:d,zoom:m}}),[n,r,e,t])}(r,o,i,s),p=t.map(R.create),d="".concat(be," ").concat(n);return a.createElement("div",{className:d},a.createElement(ne,{props:{...l,initialViewState:u},layers:p}),a.createElement(ue,{layers:p.map((e=>e.renderLegend())).reverse()}))}const Ee={name:"rdeck",type:"output",factory(e,t,n){function r({props:r,layers:c,theme:i}){o.render(a.createElement(ve,{props:r,layers:c,theme:i,width:t,height:n}),e)}return 0!==t&&0!==n||([t,n]=ce(e)),{renderValue({props:t,layers:n,theme:a}){r({props:t,layers:n,theme:a}),HTMLWidgets.shinyMode&&(Shiny.addCustomMessageHandler("".concat(e.id,":layer"),(e=>{n=function(e,t){const n=e.find((e=>e.id===t.id));if(!n)return[...e,t];return e.map((e=>{var r;return e!==n?e:{...t,data:null!=(r=t.data)?r:n.data}}))}(n,e),r({props:t,layers:n,theme:a})})),Shiny.addCustomMessageHandler("".concat(e.id,":deck"),(e=>{t={...t,...e.props},a=e.theme,r({props:t,layers:n,theme:a})})))},resize(e,t){}}}};HTMLWidgets.widget(Ee);const we=Ee,Le="0.3.0"},6561:()=>{},9559:()=>{},5533:()=>{}},t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports}return n.m=e,n.x=e=>{},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={472:0},t=[[3737,950,514,291,340,637]],r=e=>{},a=(a,o)=>{for(var c,i,[s,l,u,p]=o,d=0,m=[];d<s.length;d++)i=s[d],n.o(e,i)&&e[i]&&m.push(e[i][0]),e[i]=0;for(c in l)n.o(l,c)&&(n.m[c]=l[c]);for(u&&u(n),a&&a(o);m.length;)m.shift()();return p&&t.push.apply(t,p),r()},o=self.webpackChunkrdeck=self.webpackChunkrdeck||[];function c(){for(var r,a=0;a<t.length;a++){for(var o=t[a],c=!0,i=1;i<o.length;i++){var s=o[i];0!==e[s]&&(c=!1)}c&&(t.splice(a--,1),r=n(n.s=o[0]))}return 0===t.length&&(n.x(),n.x=e=>{}),r}o.forEach(a.bind(null,0)),o.push=a.bind(null,o.push.bind(o));var i=n.x;n.x=()=>(n.x=i||(e=>{}),(r=c)())})(),n.x()})()}));