!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.rdeck=t():e.rdeck=t()}(self,(function(){return(()=>{var e={3737:(e,t,n)=>{"use strict";n.r(t),n.d(t,{VERSION:()=>we,binding:()=>Ee});var r={};n.r(r),n.d(r,{AGGREGATION_OPERATION:()=>l.KM,ArcLayer:()=>i.zv,BitmapLayer:()=>i.hz,CPUGridLayer:()=>l.ab,ColumnLayer:()=>i.eJ,ContourLayer:()=>l.YY,GPUGridLayer:()=>l.ML,GeoJsonLayer:()=>i.UW,GreatCircleLayer:()=>s.GJ,GridCellLayer:()=>i.cJ,GridLayer:()=>l.mU,H3ClusterLayer:()=>s.cH,H3HexagonLayer:()=>s.bW,HeatmapLayer:()=>l.zP,HexagonLayer:()=>l.dX,IconLayer:()=>i.eE,LineLayer:()=>i.Ie,MVTLayer:()=>s.i3,PathLayer:()=>i.nr,PointCloudLayer:()=>i.U5,PolygonLayer:()=>i.dW,S2Layer:()=>s.jJ,ScatterplotLayer:()=>i.pU,ScenegraphLayer:()=>u.S,ScreenGridLayer:()=>l.p3,SimpleMeshLayer:()=>u.L,SolidPolygonLayer:()=>i.PJ,TerrainLayer:()=>s.tr,TextLayer:()=>i.AB,Tile3DLayer:()=>s.cY,TileLayer:()=>s.Im,TripsLayer:()=>s.Fw,_AggregationLayer:()=>l.Di,_BinSorter:()=>l.l0,_CPUAggregator:()=>l.oA,_GPUGridAggregator:()=>l.Wc,_MultiIconLayer:()=>i.vb});n(3948);var a=n(7294),o=n(3935),c=n(6042),i=(n(8559),n(4209)),l=n(6681),s=n(8623),u=n(1864);const p=[0,0,0,255];function d([e,t,n,r=255]){return"rgba(".concat(e,", ").concat(t,", ").concat(n,", ").concat(r/255,")")}function m(e,t){var n,r;return Array.isArray(e)?t||4!==e.length?((t=null!=(n=t)?n:[])[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=3===e.length?e[3]:255,t):e:"string"==typeof e?(function(e,t){if(7===e.length){const n=parseInt(e.substring(1),16);t[0]=Math.floor(n/65536),t[1]=Math.floor(n/256%256),t[2]=n%256,t[3]=255}else if(9===e.length){const n=parseInt(e.substring(1),16);t[0]=Math.floor(n/16777216),t[1]=Math.floor(n/65536%256),t[2]=Math.floor(n/256%256),t[3]=n%256}}(e,t=null!=(r=t)?r:[]),t):p}var f=n(1960),y=n(5128),h=n(3446),g=n(6297),b=n(7603),v=n(6602);function E(e){return null!==e&&"object"==typeof e&&"accessor"===e.type}function w(e,t){const n=function({col:e,dataType:t},n){if("highlightColor"===n)switch(t){case"table":return function(e){return({index:t,layer:n})=>m(n.props.data.frame[e][t])}(e);case"object":return function(e){return({object:t})=>m(t[e])}(e);case"geojson":return function(e){return({object:t})=>m(t.properties[e])}(e);default:throw TypeError("".concat(t," not supported"))}if(n.endsWith("Color"))switch(t){case"table":return function(e){return(t,{index:n,data:r,target:a})=>m(r.frame[e][n],a)}(e);case"object":return function(e){return(t,{target:n})=>m(t[e],n)}(e);case"geojson":return function(e){return(t,{target:n})=>m(t.properties[e],n)}(e);default:throw TypeError("".concat(t," not supported"))}switch(t){case"table":return function(e){return(t,{index:n,data:r})=>r.frame[e][n]}(e);case"object":return function(e){return t=>t[e]}(e);case"geojson":return function(e){return t=>t.properties[e]}(e);default:throw TypeError("".concat(t," not supported"))}}(e,t);return{...e,getData:n}}function L(e){return E(e)&&"scale"in e}function k(e,t){"palette"in e&&(e.range=e.palette.map((e=>m(e))),e.unknown=m(e.unknown));const n=function(e){switch(e.scale){case"linear":return(0,f.Z)().domain(e.domain).range(e.range).unknown(e.unknown).clamp(!0);case"power":return(0,y.ZP)().exponent(e.exponent).domain(e.domain).range(e.range).unknown(e.unknown).clamp(!0);case"log":return(0,h.Z)().base(e.base).domain(e.domain).range(e.range).unknown(e.unknown).clamp(!0);case"threshold":case"quantile":return(0,g.Z)().domain(e.domain).range(e.range).unknown(e.unknown);case"category":return(0,b.Z)().domain(e.domain).range(e.range).unknown(e.unknown);case"quantize":return(0,v.Z)().domain(e.domain).range(e.range).unknown(e.unknown);default:throw TypeError("scale ".concat(e.scale," not supported"))}}(e),r="highlightColor"===t?function({col:e,dataType:t},n){switch(t){case"table":return function(e,t){return({index:n,layer:r})=>{var a;return t(null!=(a=r.props.data.frame[e][n])?a:void 0)}}(e,n);case"object":return function(e,t){return({object:n})=>{var r;return t(null!=(r=n[e])?r:void 0)}}(e,n);case"geojson":return function(e,t){return({object:n})=>{var r;return t(null!=(r=n.properties[e])?r:void 0)}}(e,n);default:throw TypeError("".concat(t," not supported"))}}(e,n):function({col:e,dataType:t},n){switch(t){case"table":return function(e,t){return(n,{index:r,data:a})=>{var o;return t(null!=(o=a.frame[e][r])?o:void 0)}}(e,n);case"object":return function(e,t){return n=>{var r;return t(null!=(r=n[e])?r:void 0)}}(e,n);case"geojson":return function(e,t){return n=>{var r;return t(null!=(r=n.properties[e])?r:void 0)}}(e,n);default:throw TypeError("".concat(t," not supported"))}}(e,n);return{...e,name:t,getData:r,scaleData:n}}function x(e="normal"){switch(e){case"additive":return{3042:!0,blendFunc:[770,772],blendEquation:32774};case"subtractive":return{3042:!0,blendFunc:[1,775,770,772],blendEquation:[32778,32774]};case"normal":default:return{3042:!0,blendFunc:[770,771,1,771],blendEquation:[32774,32774]}}}n(5827),n(5306);function T(e){return null!==e&&"object"==typeof e&&"frame"in e}function j(e){const t=function(e){return Object.entries(e.geometry).filter((([,e])=>/MULTI/.test(e))).map((([e,t])=>({name:e,type:t})))}(e);return 0===t.length?e:t.reduce(M,e)}function M(e,{name:t,type:n}){const r=e.frame,a=Object.fromEntries(Object.entries(r).map((([e])=>[e,[]]))),o=Object.keys(e.frame).filter((e=>e!==t)),c=r[t],i=function(e){switch(e){case"MULTIPOINT":return O;case"MULTILINESTRING":return A;case"MULTIPOLYGON":return N;default:throw TypeError("".concat(e," not supported"))}}(n),l=e=>{for(const t of o)a[t].push(r[t][e])},s=[];for(let n=0;n<e.length;n++){const r=c[n];if(i(r)){a[t].push(...r);for(let t=0;t<r.length;t++){var u,p;l(n),s.push(null!=(u=null===(p=e.indices)||void 0===p?void 0:p[n])?u:n)}}else{var d,m;a[t].push(r),l(n),s.push(null!=(d=null===(m=e.indices)||void 0===m?void 0:m[n])?d:n)}}return{length:a[t].length,geometry:{...e.geometry,[t]:n.replace("MULTI","")},indices:s,frame:a}}function O(e){return Array.isArray(e[0])}function A(e){return Array.isArray(e[0][0])}function N(e){return Array.isArray(e[0][0][0])}var S=n(1118),C=n(1614),P=n(8988),Z=n(2734),_=n(8261),I=n(3767),z=n(6305),D=n(7180);class G extends S.Z{initializeState(){if(!function(e){return U.some((t=>e instanceof t))}(this))return;const e=this,t=e.getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:5121,size:3,accessor:(t,{index:n,data:r,target:a})=>e.encodePickingColor(T(r)&&Array.isArray(r.indices)?r.indices.indexOf(r.indices[n]):n,a)}})}}const U=[C.Z,P.Z,Z.Z,_.Z,I.Z,z.Z,D.Z];class H{constructor({type:e,...t}){this.type=void 0,this.props=void 0,this.scales=void 0;const n=Object.entries(t),r=function(e){const t=e.filter(R).map((([e,t])=>[e,m(t)])),n=e.find((([e])=>"colorRange"===e));n&&t.push([n[0],n[1].map((e=>m(e)))]);return t}(n),a=function(e){return e.filter((([,e])=>E(e))).map((([e,t])=>[e,L(t)?k(t,e):w(t,e)]))}(n);this.type=e;const o=Object.fromEntries([...n,...r,...a.map((([e,t])=>[e,t.getData])),...q(n),["updateTriggers",W(a)],["parameters",(c=t.parameters,i=t.blendingMode,{...c,...x(i)})]]);var c,i,l;T(o.data)&&(o.data=j(o.data),o.extensions=[new G,...null!=(l=o.extensions)?l:[]]);this.props=o,this.scales=a.filter((([,e])=>L(e))).map((([,e])=>e)),"TextLayer"===e&&"fonts"in document&&document.fonts.load("16px ".concat(t.fontFamily))}static create(e){return new H(e)}renderLayer(e){if("TripsLayer"===this.type&&void 0!==e){const t=this.props,{loopLength:n,animationSpeed:r}=t,a=n/r,o=e/1e3%a/a;t.currentTime=o*n}return new r[this.type]({...this.props})}renderLegend(){const e=this.scales.filter((e=>e.legend));return{id:this.props.id,name:this.props.name,scales:e}}}function R([e,t]){return e.endsWith("Color")&&(Array.isArray(t)||"string"==typeof t)}function W(e){const t=e=>{const{getData:t,scaleData:n,palette:r,...a}=e;return a},n=e.map((([e,n])=>[e,t(n)]));return Object.fromEntries(n)}function q(e){return e.filter((([e])=>"getColorWeight"===e||"getElevationWeight"===e)).filter((([,e])=>null!==e&&"function"!=typeof e&&!E(e))).map((([e,t])=>[e,()=>t]))}var Y=n(7391),B=n(7590);const F="_3rdxBLth1N2ey-DR8zZS3k",Q="_3a-qtBZofjlel3EyiZrLe0",J="_3L9Gh0vaiKQ5lmrBXb1Ppa",K="_4LWuEkar5BaPjDJypGFMM",V="_1SNUXvO9jR7Km5I-4zWVkl",X=({info:e})=>{if(null==e)return null;const{index:t,layer:n,x:r,y:o}=e,{name:c,tooltip:i}=n.props,l=function(e){switch(e){case"table":return(e,{index:t,data:n})=>{const r=Object.entries(n.frame).map((([e,n])=>[e,n[t]]));return Object.fromEntries(r)};case"object":return e=>e;case"geojson":return e=>{var t;return null!=(t=e.properties)?t:{}};default:throw TypeError("".concat(e," not supported"))}}(i.dataType)(e.object,{index:t,data:n.props.data}),s=!0===i.cols?Object.keys(l):i.cols;return a.createElement("div",{className:F,style:{transform:"translate(".concat(r,"px, ").concat(o,"px)")}},a.createElement("div",{className:Q},c),a.createElement("table",{className:J},a.createElement("tbody",null,s.map((e=>{var t;return a.createElement("tr",{key:e},a.createElement("td",{className:K},e),a.createElement("td",{className:V},String(null!=(t=l[e])?t:null)))})))))},$=(0,a.memo)(X);function ee(){return(ee=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function te({props:e,layers:t}){const n=(0,a.useRef)(null),[r,o]=ne(),{mapboxApiAccessToken:i,mapStyle:l,mapOptions:s,controller:u,parameters:p,blendingMode:d,...m}=e,f={...p,...x(d)},[y,h]=(0,a.useState)((()=>t.map((e=>e.renderLayer())))),g=0!==t.filter((e=>"TripsLayer"===e.type)).length;return re(g,(e=>h(t.map((t=>t.renderLayer(e)))))),a.createElement(a.Fragment,null,a.createElement(Y.Z,ee({ref:n},m,{parameters:f,layers:y,onHover:o}),a.createElement(B.Z,{id:"map",controller:u,repeat:!0},l&&a.createElement(c.Z3,ee({reuseMaps:!0},{mapboxApiAccessToken:i,mapStyle:l,mapOptions:s})))),a.createElement($,{info:r}))}const ne=()=>{const[e,t]=(0,a.useState)(null);return[e,(0,a.useCallback)((e=>{if(!e.picked||!e.layer.props.tooltip)return t(null);t(e)}),[])]},re=(e,t)=>{const n=(0,a.useRef)(0),r=(0,a.useRef)(Date.now()),o=()=>{t(Date.now()-r.current),n.current=window.requestAnimationFrame(o)};(0,a.useEffect)((()=>{if(e)return n.current=window.requestAnimationFrame(o),()=>window.cancelAnimationFrame(n.current)}),[e])};function ae(e){return e.clientHeight>0&&e.clientHeight>0?e:e.parentElement?ae(e.parentElement):null}function oe(e){const t=ae(e);if(e===t||null==t)return[e.clientWidth,e.clientHeight];const{width:n,height:r}=getComputedStyle(e),a=document.createElement("div");Object.assign(a.style,{width:n,height:r,display:"hidden"}),t.appendChild(a);const o=[a.clientWidth,a.clientHeight];return t.removeChild(a),o}const ce={legend:"_19x6CEViDqIUJgmzMHUO_L",kepler:"kepler",light:"light",layer:"_1O5QPr7CiTBczYArgl3S--","layer-name":"_1_q1TQIZ88zoNRCuCezvNi",layerName:"_1_q1TQIZ88zoNRCuCezvNi",scale:"ePCUM6mslf2Y-i0jhVFMh","scale-name":"_3YhhTqYy3O5ALWcQDpz_EK",scaleName:"_3YhhTqYy3O5ALWcQDpz_EK","scale-by":"lMTfZcYbDODR5PTtyG7HK",scaleBy:"lMTfZcYbDODR5PTtyG7HK","color-scale":"_1mPi0Qw9KZYGIt5csk3PZh",colorScale:"_1mPi0Qw9KZYGIt5csk3PZh",tick:"UU3enfH0Fz4EvQztbQYag",line:"_8tiBQbbvJsBZ-JMiVr_n9"};function ie(){return(ie=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const le=16;function se({layers:e}){return 0===e.length?null:a.createElement("div",{className:ce.legend},e.map((e=>a.createElement(ue,ie({key:e.id},e)))))}function ue({name:e,scales:t}){return 0===t.length?null:a.createElement("div",{className:ce.layer},a.createElement("div",{className:ce.layerName},e),t.map((e=>a.createElement(pe,ie({key:e.name},e)))))}function pe(e){const t=e.name.replace(/^get/,"").replace(/([A-Z])/g," $1").toLowerCase();const n="palette"in e;const r=function(e){return"linear"===e.scale||"power"===e.scale||"log"===e.scale}(e),o=function(e){return"threshold"===e.scale||"quantile"===e.scale||"quantize"===e.scale}(e);return a.createElement("div",{className:ce.scale},a.createElement("div",{className:ce.scaleName},t),a.createElement("span",{className:ce.scaleBy},"by "),a.createElement("span",{className:ce.fieldName},e.col),n&&r&&a.createElement(de,e),n&&o&&a.createElement(me,e),n&&"category"===e.scale&&a.createElement(fe,e))}const de=({ticks:e,scaleData:t})=>{const n=e.map(((e,t)=>t)).slice(1,-1),r=le*(e.length-1),o=r+10+1;return a.createElement("svg",{className:ce.colorScale,height:o,shapeRendering:"crispEdges"},a.createElement("svg",{y:5},a.createElement("image",{width:20,height:r,href:he(t),preserveAspectRatio:"none"}),n.map((e=>a.createElement("line",{key:e,className:ce.line,x2:20,y1:le*e,y2:le*e})))),a.createElement(ye,{ticks:e,y:-2}))},me=({ticks:e,range:t})=>{const n=t.map(d),r=le*(e.length-1)+10+1;return a.createElement("svg",{className:ce.colorScale,height:r,shapeRendering:"crispEdges"},a.createElement("svg",{y:5},n.map(((e,t)=>a.createElement("rect",{key:t,width:20,height:le,y:t*le,fill:e})))),a.createElement(ye,{ticks:e,y:-2}))};function fe({ticks:e,range:t,unknownTick:n,unknown:r}){const o=n?[...t,r]:t,c=n?[...e,n]:e,i=o.map(d),l=le*c.length;return a.createElement("svg",{className:ce.colorScale,height:l},a.createElement("svg",null,i.map(((e,t)=>a.createElement("rect",{key:t,width:20,height:14,y:1+t*le,fill:e})))),a.createElement(ye,{ticks:c}))}function ye({ticks:e,x:t=28,y:n=0}){return a.createElement("svg",{x:t,y:n},e.map(((e,t)=>a.createElement("text",{key:t,className:ce.tick,y:le*t,dy:10},String(e)))))}function he(e,t=200){const n=e.range().length,r=[...Array(n).keys()].map((e=>e/(n-1))),a=e.copy().range(r).invert,o=document.createElement("canvas"),c=o.getContext("2d");o.width=1,o.height=t;for(let n=0;n<t;n++)c.fillStyle=d(e(a(n/t))),c.fillRect(0,n,1,1);return o.toDataURL()}const ge="rdeck";function be({props:e,layers:t,theme:n="kepler",width:r,height:o}){const{initialBounds:i,initialViewState:l,...s}=e,u=function(e,t,n,r){return(0,a.useMemo)((()=>{if(!Array.isArray(n))return r;const[a,o,i,l]=n,s=[[Math.max(-180,a),Math.max(o,-85.051129)],[Math.min(180,i),Math.min(l,85.051129)]],u=new c.DW({width:e,height:t}),{longitude:p,latitude:d,zoom:m}=u.fitBounds(s);return{...r,longitude:p,latitude:d,zoom:m}}),[n,r,e,t])}(r,o,i,l),p=t.map(H.create),d="".concat(ge," ").concat(n);return a.createElement("div",{className:d},a.createElement(te,{props:{...s,initialViewState:u},layers:p}),a.createElement(se,{layers:p.map((e=>e.renderLegend())).reverse()}))}const ve={name:"rdeck",type:"output",factory(e,t,n){function r({props:r,layers:c,theme:i}){o.render(a.createElement(be,{props:r,layers:c,theme:i,width:t,height:n}),e)}return 0!==t&&0!==n||([t,n]=oe(e)),{renderValue({props:t,layers:n,theme:a}){r({props:t,layers:n,theme:a}),HTMLWidgets.shinyMode&&(Shiny.addCustomMessageHandler("".concat(e.id,":layer"),(e=>{n=function(e,t){const n=e.find((e=>e.id===t.id));if(!n)return[...e,t];return e.map((e=>{var r;return e!==n?e:{...t,data:null!=(r=t.data)?r:n.data}}))}(n,e),r({props:t,layers:n,theme:a})})),Shiny.addCustomMessageHandler("".concat(e.id,":deck"),(e=>{t={...t,...e.props},a=e.theme,r({props:t,layers:n,theme:a})})))},resize(e,t){}}}};HTMLWidgets.widget(ve);const Ee=ve,we="0.3.0"},6561:()=>{},9559:()=>{},5533:()=>{}},t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports}return n.m=e,n.x=e=>{},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={472:0},t=[[3737,950,514,291,340,637]],r=e=>{},a=(a,o)=>{for(var c,i,[l,s,u,p]=o,d=0,m=[];d<l.length;d++)i=l[d],n.o(e,i)&&e[i]&&m.push(e[i][0]),e[i]=0;for(c in s)n.o(s,c)&&(n.m[c]=s[c]);for(u&&u(n),a&&a(o);m.length;)m.shift()();return p&&t.push.apply(t,p),r()},o=self.webpackChunkrdeck=self.webpackChunkrdeck||[];function c(){for(var r,a=0;a<t.length;a++){for(var o=t[a],c=!0,i=1;i<o.length;i++){var l=o[i];0!==e[l]&&(c=!1)}c&&(t.splice(a--,1),r=n(n.s=o[0]))}return 0===t.length&&(n.x(),n.x=e=>{}),r}o.forEach(a.bind(null,0)),o.push=a.bind(null,o.push.bind(o));var i=n.x;n.x=()=>(n.x=i||(e=>{}),(r=c)())})(),n.x()})()}));