!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.rdeck=t():e.rdeck=t()}(self,(function(){return(()=>{var e={67:(e,t,n)=>{"use strict";n.r(t),n.d(t,{VERSION:()=>xe,binding:()=>je});var r={};n.r(r),n.d(r,{AGGREGATION_OPERATION:()=>l.KM,ArcLayer:()=>c.zv,BitmapLayer:()=>c.hz,CPUGridLayer:()=>l.ab,ColumnLayer:()=>c.eJ,ContourLayer:()=>l.YY,GPUGridLayer:()=>l.ML,GeoJsonLayer:()=>c.UW,GreatCircleLayer:()=>u.GJ,GridCellLayer:()=>c.cJ,GridLayer:()=>l.mU,H3ClusterLayer:()=>u.cH,H3HexagonLayer:()=>u.bW,HeatmapLayer:()=>l.zP,HexagonLayer:()=>l.dX,IconLayer:()=>c.eE,LineLayer:()=>c.Ie,MVTLayer:()=>u.i3,PathLayer:()=>c.nr,PointCloudLayer:()=>c.U5,PolygonLayer:()=>c.dW,S2Layer:()=>u.jJ,ScatterplotLayer:()=>c.pU,ScenegraphLayer:()=>d.S,ScreenGridLayer:()=>l.p3,SimpleMeshLayer:()=>d.L,SolidPolygonLayer:()=>c.PJ,TerrainLayer:()=>u.tr,TextLayer:()=>c.AB,Tile3DLayer:()=>u.cY,TileLayer:()=>u.Im,TripsLayer:()=>u.Fw,_AggregationLayer:()=>l.Di,_BinSorter:()=>l.l0,_CPUAggregator:()=>l.oA,_GPUGridAggregator:()=>l.Wc,_MultiIconLayer:()=>c.vb,_binaryToFeature:()=>c.ip,_findIndexBinary:()=>c.Ex});n(8559);var a=n(5893),i=n(3935),o=n(7294),s=n(2923),c=n(3810),l=n(2380),u=n(7305),d=n(1864),p=n(5736);const h=[0,0,0,255];function f([e,t,n,r=255]){return`rgba(${e}, ${t}, ${n}, ${r/255})`}function g(e,t){return Array.isArray(e)?t||4!==e.length?((t=null!=t?t:[])[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=3===e.length?e[3]:255,t):e:"string"==typeof e?(function(e,t){if(7===e.length){const n=parseInt(e.substring(1),16);t[0]=Math.floor(n/65536),t[1]=Math.floor(n/256%256),t[2]=n%256,t[3]=255}else if(9===e.length){const n=parseInt(e.substring(1),16);t[0]=Math.floor(n/16777216),t[1]=Math.floor(n/65536%256),t[2]=Math.floor(n/256%256),t[3]=n%256}}(e,t=null!=t?t:[]),t):h}var y=n(1960),m=n(5128),v=n(3446),b=n(6297),j=n(7603),x=n(6602);function L(e){return null!==e&&"object"==typeof e&&"accessor"===e.type}function w(e,t){const n=function({col:e,dataType:t},n){if("highlightColor"===n)switch(t){case"table":return function(e){return({index:t,layer:n})=>g(n.props.data.frame[e][t])}(e);case"object":return function(e){return({object:t})=>g(t[e])}(e);case"geojson":return function(e){return({object:t})=>g(t.properties[e])}(e);default:throw TypeError(`${t} not supported`)}if(n.endsWith("Color"))switch(t){case"table":return function(e){return(t,{index:n,data:r,target:a})=>g(r.frame[e][n],a)}(e);case"object":return function(e){return(t,{target:n})=>g(t[e],n)}(e);case"geojson":return function(e){return(t,{target:n})=>g(t.properties[e],n)}(e);default:throw TypeError(`${t} not supported`)}switch(t){case"table":return function(e){return(t,{index:n,data:r})=>r.frame[e][n]}(e);case"object":return function(e){return t=>t[e]}(e);case"geojson":return function(e){return t=>t.properties[e]}(e);default:throw TypeError(`${t} not supported`)}}(e,t);return{...e,getData:n}}function O(e){return L(e)&&"scale"in e}function T(e,t){"palette"in e&&(e.range=e.palette.map((e=>g(e))),e.unknown=g(e.unknown));const n=function(e){switch(e.scale){case"linear":return(0,y.Z)().domain(e.domain).range(e.range).unknown(e.unknown).clamp(!0);case"power":return(0,m.ZP)().exponent(e.exponent).domain(e.domain).range(e.range).unknown(e.unknown).clamp(!0);case"log":return(0,v.Z)().base(e.base).domain(e.domain).range(e.range).unknown(e.unknown).clamp(!0);case"threshold":case"quantile":return(0,b.Z)().domain(e.domain).range(e.range).unknown(e.unknown);case"category":return(0,j.Z)().domain(e.domain).range(e.range).unknown(e.unknown);case"quantize":return(0,x.Z)().domain(e.domain).range(e.range).unknown(e.unknown);default:throw TypeError(`scale ${e.scale} not supported`)}}(e),r="highlightColor"===t?function({col:e,dataType:t},n){switch(t){case"table":return function(e,t){return({index:n,layer:r})=>{var a;return t(null!==(a=r.props.data.frame[e][n])&&void 0!==a?a:void 0)}}(e,n);case"object":return function(e,t){return({object:n})=>{var r;return t(null!==(r=n[e])&&void 0!==r?r:void 0)}}(e,n);case"geojson":return function(e,t){return({object:n})=>{var r;return t(null!==(r=n.properties[e])&&void 0!==r?r:void 0)}}(e,n);default:throw TypeError(`${t} not supported`)}}(e,n):function({col:e,dataType:t},n){switch(t){case"table":return function(e,t){return(n,{index:r,data:a})=>{var i;return t(null!==(i=a.frame[e][r])&&void 0!==i?i:void 0)}}(e,n);case"object":return function(e,t){return n=>{var r;return t(null!==(r=n[e])&&void 0!==r?r:void 0)}}(e,n);case"geojson":return function(e,t){return n=>{var r;return t(null!==(r=n.properties[e])&&void 0!==r?r:void 0)}}(e,n);default:throw TypeError(`${t} not supported`)}}(e,n);return{...e,name:t,getData:r,scaleData:n}}var k=n(1116);function A(e="normal"){switch(e){case"additive":return{[k.Z.BLEND]:!0,blendFunc:[k.Z.SRC_ALPHA,k.Z.DST_ALPHA],blendEquation:k.Z.FUNC_ADD};case"subtractive":return{[k.Z.BLEND]:!0,blendFunc:[k.Z.ONE,k.Z.ONE_MINUS_DST_COLOR,k.Z.SRC_ALPHA,k.Z.DST_ALPHA],blendEquation:[k.Z.FUNC_SUBTRACT,k.Z.FUNC_ADD]};case"normal":default:return{[k.Z.BLEND]:!0,blendFunc:[k.Z.SRC_ALPHA,k.Z.ONE_MINUS_SRC_ALPHA,k.Z.ONE,k.Z.ONE_MINUS_SRC_ALPHA],blendEquation:[k.Z.FUNC_ADD,k.Z.FUNC_ADD]}}}function N(e){return null!==e&&"object"==typeof e&&"frame"in e}function _(e){const t=function(e){return Object.entries(e.geometry).filter((([,e])=>/MULTI/.test(e))).map((([e,t])=>({name:e,type:t})))}(e);return 0===t.length?e:t.reduce(S,e)}function S(e,{name:t,type:n}){var r,a,i,o;const s=e.frame,c=Object.fromEntries(Object.entries(s).map((([e])=>[e,[]]))),l=Object.keys(e.frame).filter((e=>e!==t)),u=s[t],d=function(e){switch(e){case"MULTIPOINT":return Z;case"MULTILINESTRING":return E;case"MULTIPOLYGON":return C;default:throw TypeError(`${e} not supported`)}}(n),p=e=>{for(const t of l)c[t].push(s[t][e])},h=[];for(let n=0;n<e.length;n++){const s=u[n];if(d(s)){c[t].push(...s);for(let t=0;t<s.length;t++)p(n),h.push(null!==(a=null===(r=e.indices)||void 0===r?void 0:r[n])&&void 0!==a?a:n)}else c[t].push(s),p(n),h.push(null!==(o=null===(i=e.indices)||void 0===i?void 0:i[n])&&void 0!==o?o:n)}return{length:c[t].length,geometry:{...e.geometry,[t]:n.replace("MULTI","")},indices:h,frame:c}}function Z(e){return Array.isArray(e[0])}function E(e){return Array.isArray(e[0][0])}function C(e){return Array.isArray(e[0][0][0])}var M=n(1118),D=n(1614),P=n(8988),I=n(2734),U=n(8261),z=n(3767),R=n(6305),H=n(7180);class G extends M.Z{initializeState(){if(!function(e){return B.some((t=>e instanceof t))}(this))return;const e=this,t=e.getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:k.Z.UNSIGNED_BYTE,size:3,accessor:(t,{index:n,data:r,target:a})=>e.encodePickingColor(N(r)&&Array.isArray(r.indices)?r.indices.indexOf(r.indices[n]):n,a)}})}}const B=[D.Z,P.Z,I.Z,U.Z,z.Z,R.Z,H.Z];class F{constructor({type:e,...t}){var n;const r=Object.entries(t),a=function(e){const t=e.filter($).map((([e,t])=>[e,g(t)])),n=e.find((([e])=>"colorRange"===e));n&&t.push([n[0],n[1].map((e=>g(e)))]);return t}(r),i=function(e){return e.filter((([,e])=>L(e))).map((([e,t])=>[e,O(t)?T(t,e):w(t,e)]))}(r);this.type=e;const o=Object.fromEntries([...r,...a,...i.map((([e,t])=>[e,t.getData])),...Y(r),["updateTriggers",W(i)],["parameters",(s=t.parameters,c=t.blendingMode,{...s,...A(c)})]]);var s,c;N(o.data)&&(o.data=_(o.data),o.extensions=[new G,...null!==(n=o.extensions)&&void 0!==n?n:[]]),"TileLayer"===e&&(o.renderSubLayers=e=>{const{bbox:{west:t,south:n,east:r,north:a},x:i,y:o,z:s}=e.tile;return new p.Z({...e,data:[{z:s,x:i,y:o}],image:e.data,bounds:[t,n,r,a]})}),this.props=o,this.scales=i.filter((([,e])=>O(e))).map((([,e])=>e)),"TextLayer"===e&&"fonts"in document&&document.fonts.load(`16px ${t.fontFamily}`)}static create(e){return new F(e)}renderLayer(e){if("TripsLayer"===this.type&&void 0!==e){const t=this.props,{loopLength:n,animationSpeed:r}=t,a=n/r,i=e/1e3%a/a;t.currentTime=i*n}return new r[this.type]({...this.props})}renderLegend(){const e=this.scales.filter((e=>e.legend));return{id:this.props.id,name:this.props.name,scales:e}}}function $([e,t]){return e.endsWith("Color")&&(Array.isArray(t)||"string"==typeof t)}function W(e){const t=e=>{const{getData:t,scaleData:n,palette:r,...a}=e;return a},n=e.map((([e,n])=>[e,t(n)]));return Object.fromEntries(n)}function Y(e){return e.filter((([e])=>"getColorWeight"===e||"getElevationWeight"===e)).filter((([,e])=>null!==e&&"function"!=typeof e&&!L(e))).map((([e,t])=>[e,()=>t]))}n(6158);var q=n(7590),Q=n(7391);const J="_3rdxBLth1N2ey-DR8zZS3k",K="_3a-qtBZofjlel3EyiZrLe0",V="_3L9Gh0vaiKQ5lmrBXb1Ppa",X="_4LWuEkar5BaPjDJypGFMM",ee="_1SNUXvO9jR7Km5I-4zWVkl",te=(0,o.memo)((({info:e})=>{if(null==e)return null;const{index:t,layer:n,x:r,y:i}=e,{name:o,tooltip:s}=n.props,c=function(e){switch(e){case"table":return(e,{index:t,data:n})=>{const r=Object.entries(n.frame).map((([e,n])=>[e,n[t]]));return Object.fromEntries(r)};case"object":return e=>e;case"geojson":return e=>{var t;return null!==(t=e.properties)&&void 0!==t?t:{}};default:throw TypeError(`${e} not supported`)}}(s.dataType)(e.object,{index:t,data:n.props.data}),l=!0===s.cols?Object.keys(c):s.cols;return(0,a.jsxs)("div",Object.assign({className:J,style:{transform:`translate(${r}px, ${i}px)`}},{children:[(0,a.jsx)("div",Object.assign({className:K},{children:o}),void 0),(0,a.jsx)("table",Object.assign({className:V},{children:(0,a.jsx)("tbody",{children:l.map((e=>{var t;return(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",Object.assign({className:X},{children:e}),void 0),(0,a.jsx)("td",Object.assign({className:ee},{children:String(null!==(t=c[e])&&void 0!==t?t:null)}),void 0)]},e)}))},void 0)}),void 0)]}),void 0)}));function ne({props:e,layers:t}){const n=(0,o.useRef)(null),[r,i]=re(),{mapboxApiAccessToken:c,mapStyle:l,mapOptions:u,controller:d,parameters:p,blendingMode:h,...f}=e,g={...p,...A(h)},[y,m]=(0,o.useState)(0),v=0!==t.filter((e=>"TripsLayer"===e.type)).length;ae(v,(e=>m(e)));const b=t.map((e=>e.renderLayer(y)));return(0,a.jsxs)(o.Fragment,{children:[(0,a.jsx)(Q.Z,Object.assign({ref:n},f,{parameters:g,layers:b,onHover:i},{children:(0,a.jsx)(q.Z,Object.assign({id:"map",controller:d,repeat:!0},{children:l&&(0,a.jsx)(s.Z3,Object.assign({reuseMaps:!0},{mapboxApiAccessToken:c,mapStyle:l,mapOptions:u}),void 0)}),void 0)}),void 0),(0,a.jsx)(te,{info:r},void 0)]},void 0)}const re=()=>{const[e,t]=(0,o.useState)(null);return[e,(0,o.useCallback)((e=>{if(!e.picked||!e.layer.props.tooltip)return t(null);t(e)}),[])]},ae=(e,t)=>{const n=(0,o.useRef)(0),r=(0,o.useRef)(Date.now()),a=()=>{t(Date.now()-r.current),n.current=window.requestAnimationFrame(a)};(0,o.useEffect)((()=>{if(e)return n.current=window.requestAnimationFrame(a),()=>window.cancelAnimationFrame(n.current)}),[e])};function ie(e){return e.clientHeight>0&&e.clientHeight>0?e:e.parentElement?ie(e.parentElement):null}function oe(e){const t=ie(e);if(e===t||null==t)return[e.clientWidth,e.clientHeight];const{width:n,height:r}=getComputedStyle(e),a=document.createElement("div");Object.assign(a.style,{width:n,height:r,display:"hidden"}),t.appendChild(a);const i=[a.clientWidth,a.clientHeight];return t.removeChild(a),i}const se={legend:"_19x6CEViDqIUJgmzMHUO_L",kepler:"kepler",light:"light",layer:"_1O5QPr7CiTBczYArgl3S--","layer-name":"_1_q1TQIZ88zoNRCuCezvNi",layerName:"_1_q1TQIZ88zoNRCuCezvNi",scale:"ePCUM6mslf2Y-i0jhVFMh","scale-name":"_3YhhTqYy3O5ALWcQDpz_EK",scaleName:"_3YhhTqYy3O5ALWcQDpz_EK","scale-by":"lMTfZcYbDODR5PTtyG7HK",scaleBy:"lMTfZcYbDODR5PTtyG7HK","color-scale":"_1mPi0Qw9KZYGIt5csk3PZh",colorScale:"_1mPi0Qw9KZYGIt5csk3PZh",tick:"UU3enfH0Fz4EvQztbQYag",line:"_8tiBQbbvJsBZ-JMiVr_n9"},ce=16;function le({layers:e}){return 0===e.length?null:(0,a.jsx)("div",Object.assign({className:se.legend},{children:e.map((e=>(0,a.jsx)(ue,Object.assign({},e),e.id)))}),void 0)}function ue({name:e,scales:t}){return 0===t.length?null:(0,a.jsxs)("div",Object.assign({className:se.layer},{children:[(0,a.jsx)("div",Object.assign({className:se.layerName},{children:e}),void 0),t.map((e=>(0,a.jsx)(de,Object.assign({},e),e.name)))]}),void 0)}function de(e){const t=e.name.replace(/^get/,"").replace(/([A-Z])/g," $1").toLowerCase();const n="palette"in e;const r=function(e){return"linear"===e.scale||"power"===e.scale||"log"===e.scale}(e),i=function(e){return"threshold"===e.scale||"quantile"===e.scale||"quantize"===e.scale}(e);return(0,a.jsxs)("div",Object.assign({className:se.scale},{children:[(0,a.jsx)("div",Object.assign({className:se.scaleName},{children:t}),void 0),(0,a.jsx)("span",Object.assign({className:se.scaleBy},{children:"by "}),void 0),(0,a.jsx)("span",Object.assign({className:se.fieldName},{children:e.col}),void 0),n&&r&&(0,a.jsx)(pe,Object.assign({},e),void 0),n&&i&&(0,a.jsx)(he,Object.assign({},e),void 0),n&&"category"===e.scale&&(0,a.jsx)(fe,Object.assign({},e),void 0)]}),void 0)}const pe=({ticks:e,scaleData:t})=>{const n=e.map(((e,t)=>t)).slice(1,-1),r=ce*(e.length-1),i=r+10+1;return(0,a.jsxs)("svg",Object.assign({className:se.colorScale,height:i,shapeRendering:"crispEdges"},{children:[(0,a.jsxs)("svg",Object.assign({y:5},{children:[(0,a.jsx)("image",{width:20,height:r,href:ye(t),preserveAspectRatio:"none"},void 0),n.map((e=>(0,a.jsx)("line",{className:se.line,x2:20,y1:ce*e,y2:ce*e},e)))]}),void 0),(0,a.jsx)(ge,{ticks:e,y:-2},void 0)]}),void 0)},he=({ticks:e,range:t})=>{const n=t.map(f),r=ce*(e.length-1)+10+1;return(0,a.jsxs)("svg",Object.assign({className:se.colorScale,height:r,shapeRendering:"crispEdges"},{children:[(0,a.jsx)("svg",Object.assign({y:5},{children:n.map(((e,t)=>(0,a.jsx)("rect",{width:20,height:ce,y:t*ce,fill:e},t)))}),void 0),(0,a.jsx)(ge,{ticks:e,y:-2},void 0)]}),void 0)};function fe({ticks:e,range:t,unknownTick:n,unknown:r}){const i=n?[...t,r]:t,o=n?[...e,n]:e,s=i.map(f),c=ce*o.length;return(0,a.jsxs)("svg",Object.assign({className:se.colorScale,height:c},{children:[(0,a.jsx)("svg",{children:s.map(((e,t)=>(0,a.jsx)("rect",{width:20,height:14,y:1+t*ce,fill:e},t)))},void 0),(0,a.jsx)(ge,{ticks:o},void 0)]}),void 0)}function ge({ticks:e,x:t=28,y:n=0}){return(0,a.jsx)("svg",Object.assign({},{x:t,y:n},{children:e.map(((e,t)=>(0,a.jsx)("text",Object.assign({className:se.tick,y:ce*t,dy:10},{children:String(e)}),t)))}),void 0)}function ye(e,t=200){const n=e.range().length,r=[...Array(n).keys()].map((e=>e/(n-1))),a=e.copy().range(r).invert,i=document.createElement("canvas"),o=i.getContext("2d");i.width=1,i.height=t;for(let n=0;n<t;n++)o.fillStyle=f(e(a(n/t))),o.fillRect(0,n,1,1);return i.toDataURL()}const me={rdeck:"rdeck"};function ve({props:e,layers:t,theme:n="kepler",lazyLoad:r=!1,width:i,height:c}){const{initialBounds:l,initialViewState:u,...d}=e,p=function(e,t,n,r){return(0,o.useMemo)((()=>{if(!Array.isArray(n))return r;const[a,i,o,c]=n,l=[[Math.max(-180,a),Math.max(i,-85.051129)],[Math.min(180,o),Math.min(c,85.051129)]],u=new s.DW({width:e,height:t}),{longitude:d,latitude:p,zoom:h}=u.fitBounds(l);return{...r,longitude:d,latitude:p,zoom:h}}),[n,r,e,t])}(i,c,l,u),h=t.map(F.create),f=(0,o.useRef)(null),g=function(e,t){const[n,r]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{if(t&&e.current){const t=new IntersectionObserver((e=>{r(e[0].isIntersecting)}),{threshold:0});return t.observe(e.current),()=>t.disconnect()}}),[t,e]),n}(f,r),y=!r||g,m=[me.rdeck,n].join(" ");return(0,a.jsxs)("div",Object.assign({ref:f,className:m},{children:[y&&(0,a.jsx)(ne,{props:{...d,initialViewState:p},layers:h},void 0),(0,a.jsx)(le,{layers:h.map((e=>e.renderLegend())).reverse()},void 0)]}),void 0)}const be={name:"rdeck",type:"output",factory(e,t,n){function r(r){i.render((0,a.jsx)(ve,Object.assign({},{...r,width:t,height:n}),void 0),e)}return 0!==t&&0!==n||([t,n]=oe(e)),{renderValue({props:t,layers:n,theme:a,lazyLoad:i}){r({props:t,layers:n,theme:a,lazyLoad:i}),HTMLWidgets.shinyMode&&(Shiny.addCustomMessageHandler(`${e.id}:layer`,(e=>{n=function(e,t){const n=e.find((e=>e.id===t.id));if(!n)return[...e,t];return e.map((e=>{var r;return e!==n?e:{...t,data:null!==(r=t.data)&&void 0!==r?r:n.data}}))}(n,e),r({props:t,layers:n,theme:a,lazyLoad:i})})),Shiny.addCustomMessageHandler(`${e.id}:deck`,(e=>{t={...t,...e.props},a=e.theme,r({props:t,layers:n,theme:a,lazyLoad:i})})))},resize(e,t){}}}};HTMLWidgets.widget(be);const je=be,xe="0.4.0-dev"},6561:()=>{},9559:()=>{},5533:()=>{}},t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports}return n.m=e,n.x=e=>{},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={472:0},t=[[67,950,514,291,340,637]],r=e=>{},a=(a,i)=>{for(var o,s,[c,l,u,d]=i,p=0,h=[];p<c.length;p++)s=c[p],n.o(e,s)&&e[s]&&h.push(e[s][0]),e[s]=0;for(o in l)n.o(l,o)&&(n.m[o]=l[o]);for(u&&u(n),a&&a(i);h.length;)h.shift()();return d&&t.push.apply(t,d),r()},i=self.webpackChunkrdeck=self.webpackChunkrdeck||[];function o(){for(var r,a=0;a<t.length;a++){for(var i=t[a],o=!0,s=1;s<i.length;s++){var c=i[s];0!==e[c]&&(o=!1)}o&&(t.splice(a--,1),r=n(n.s=i[0]))}return 0===t.length&&(n.x(),n.x=e=>{}),r}i.forEach(a.bind(null,0)),i.push=a.bind(null,i.push.bind(i));var s=n.x;n.x=()=>(n.x=s||(e=>{}),(r=o)())})(),n.x()})()}));